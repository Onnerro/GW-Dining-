<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GW Dining | Discounts & Perks</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Bootstrap Icons -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Shared navbar -->
  <div id="navbar-container"></div>

  <main>

    <!-- HERO / INTRO -->
    <section class="py-5 bg-dark text-white">
      <div class="container">
        <div class="row align-items-center g-4">
          <div class="col-lg-7">
            <h1 class="fw-bold mb-3">Discounts &amp; Perks</h1>
            <p class="lead mb-3">
              Stretch your Dining Dollars with student-only deals, off-peak specials,
              and hidden perks at your favorite GW dining locations.
            </p>
            <p class="mb-0">
              Look for offers like <strong>student discounts</strong>, 
              <strong>combo deals</strong>, and <strong>evening specials</strong>.
              Always bring your <strong>GWorld</strong> if a perk requires student ID.
            </p>
          </div>
          <div class="col-lg-5">
            <div class="p-3 p-md-4 bg-light text-dark rounded-3 shadow-sm">
              <h5 class="fw-semibold mb-3">
                How to make the most of your perks
              </h5>
              <ul class="mb-0 small">
                <li>Plan meals around <strong>off-peak discounts</strong> (2–5 PM, late evenings).</li>
                <li>Use <strong>Dining Dollars</strong> where bonuses or % off are offered.</li>
                <li>Grab friends and use <strong>group deals</strong> at hubs like District House.</li>
                <li>Don’t forget <strong>coffee &amp; pastry combos</strong> before morning classes.</li>
                <li>Check which locations are on <strong>Uber Eats / DoorDash / Grubhub</strong> for late-night study sessions.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FILTER BAR (simple) -->
    <section class="py-3 border-bottom bg-white">
      <div class="container">
        <div class="row g-2 align-items-center">
          <div class="col-md-4">
            <label class="form-label mb-1 small text-muted text-uppercase">
              Campus
            </label>
            <select id="discountCampusFilter" class="form-select form-select-sm">
              <option value="all">All campuses</option>
              <option value="Foggy Bottom">Foggy Bottom</option>
              <option value="Mount Vernon">Mount Vernon</option>
              <option value="Hillel">Hillel</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label mb-1 small text-muted text-uppercase">
              Perk Type
            </label>
            <select id="discountTypeFilter" class="form-select form-select-sm">
              <option value="all">All perk types</option>
              <option value="Student Discount">Student Discount</option>
              <option value="Combo Deal">Combo Deal</option>
              <option value="Group Discount">Group Discount</option>
              <option value="Breakfast Deal">Breakfast Deal</option>
              <option value="Happy Hour">Happy Hour</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label mb-1 small text-muted text-uppercase">
              Search
            </label>
            <div class="input-group input-group-sm">
              <span class="input-group-text bg-white">
                <i class="bi bi-search text-muted"></i>
              </span>
              <input
                type="text"
                id="discountSearch"
                class="form-control"
                placeholder="Search locations or perks..."
              />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- DISCOUNT CARDS -->
    <section class="py-5">
      <div class="container">
        <h2 class="h4 fw-bold mb-4">Current Discounts &amp; Perks</h2>

        <div id="discountsContainer" class="row g-4">
          <!-- cards populated by inline JS -->
        </div>
      </div>
    </section>

  </main>

  <!-- Shared footer -->
  <div id="footer-container"></div>

  <!-- Main JS (cart, menus, locations) -->
  <script src="main.js"></script>

  <!-- Navbar loader + cart wiring -->
  <script>
    const CURRENT_PAGE = "discounts"; // match data-page on nav link

    fetch("navbar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar-container").innerHTML = html;

        // Highlight active nav link
        const activeLink = document.querySelector(
          '.gw-nav-link[data-page="' + CURRENT_PAGE + '"]'
        );
        if (activeLink) activeLink.classList.add("active");

        // Cart wiring – after navbar/offcanvas exist
        if (window.setupCartOffcanvasEvents) {
          window.setupCartOffcanvasEvents();
        }
        if (window.updateCartCountDisplay) {
          window.updateCartCountDisplay();
        }
        if (window.renderCartPanel) {
          window.renderCartPanel();
        }
      })
      .catch(err => console.error("Navbar load error:", err));
  </script>

  <!-- Footer loader -->
  <script>
    fetch("footer.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("footer-container").innerHTML = html;
      })
      .catch(err => console.error("Footer load error:", err));
  </script>

  <!-- Inline script: build discounts from dining-locations.json -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const container = document.getElementById("discountsContainer");
      const campusFilter = document.getElementById("discountCampusFilter");
      const typeFilter   = document.getElementById("discountTypeFilter");
      const searchInput  = document.getElementById("discountSearch");

      let allLocationsWithDiscount = [];

      function renderDiscountCards(list) {
        if (!container) return;

        if (!list.length) {
          container.innerHTML =
            '<p class="text-muted mb-0">No discounts match your filters right now. Try adjusting campus or perk type.</p>';
          return;
        }

        container.innerHTML = list.map(loc => {
          const d = loc.discount || {};
          const tags = (d.tags || []).map(t => `
              <span class="badge rounded-pill bg-light text-muted border me-1 mb-1">
                ${t}
              </span>
          `).join("");

          // NEW: link straight to Dining Locations page with this specific location selected
          const locUrl = "dining-locations.html?loc=" + encodeURIComponent(loc.id);

          return `
            <div class="col-md-6 col-lg-4">
              <article class="h-100 card border-0 shadow-sm">
                <!-- image placeholder; you can swap in real images later -->
                <div class="ratio ratio-16x9 bg-light">
                  <!-- <img src="images/perks/${loc.id}.jpg" class="card-img-top" alt="${loc.name}"> -->
                </div>
                <div class="card-body d-flex flex-column">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                      <h5 class="card-title mb-1">${loc.name}</h5>
                      <p class="small text-muted mb-1">
                        ${loc.campus} &middot; ${loc.type}
                      </p>
                    </div>
                    <span class="badge bg-warning text-dark">
                      ${d.badge || "Special Offer"}
                    </span>
                  </div>

                  <p class="fw-semibold mb-1">${d.amount || ""}</p>
                  <p class="small mb-2">${d.details || ""}</p>

                  <p class="small text-muted mb-2">
                    <i class="bi bi-clock me-1"></i>
                    ${d.validTimes || "See location for details"}
                  </p>

                  <p class="small text-muted mb-2">
                    <i class="bi bi-card-checklist me-1"></i>
                    ${d.category || "Dining Perk"}
                  </p>

                  ${
                    d.requiresStudentId
                      ? '<p class="small text-muted mb-2"><i class="bi bi-person-badge me-1"></i>Student ID required</p>'
                      : ""
                  }

                  ${tags ? `<div class="mb-3">${tags}</div>` : ""}

                  <div class="mt-auto d-flex flex-wrap gap-2">
                    <a
                      href="${locUrl}"
                      class="btn btn-sm btn-outline-primary"
                    >
                      View in Dining Locations
                    </a>
                    <a
                      href="${locUrl}"
                      class="btn btn-sm btn-outline-secondary"
                    >
                      View on Map
                    </a>
                  </div>
                </div>
              </article>
            </div>
          `;
        }).join("");
      }

      function applyDiscountFilters() {
        const campusVal = campusFilter ? campusFilter.value : "all";
        const typeVal   = typeFilter ? typeFilter.value : "all";
        const query     = (searchInput ? searchInput.value : "").trim().toLowerCase();

        const filtered = allLocationsWithDiscount.filter(loc => {
          const d = loc.discount || {};
          const campusMatch =
            campusVal === "all" || (loc.campus || "").toLowerCase() === campusVal.toLowerCase();

          let typeMatch = true;
          if (typeVal !== "all") {
            // match against badge or top-level "Student Discount" etc.
            typeMatch =
              (d.badge || "").toLowerCase().includes(typeVal.toLowerCase()) ||
              (d.category || "").toLowerCase().includes(typeVal.toLowerCase());
          }

          let searchMatch = true;
          if (query) {
            const haystack = (
              loc.name + " " +
              loc.campus + " " +
              (loc.description || "") + " " +
              (d.details || "") + " " +
              (d.category || "")
            ).toLowerCase();
            searchMatch = haystack.includes(query);
          }

          return campusMatch && typeMatch && searchMatch;
        });

        renderDiscountCards(filtered);
      }

      // Fetch dining locations and extract those with discounts
      fetch("data/dining-locations.json")
        .then(res => res.json())
        .then(data => {
          allLocationsWithDiscount = (data || []).filter(loc => loc.discount);
          renderDiscountCards(allLocationsWithDiscount);

          if (campusFilter) {
            campusFilter.addEventListener("change", applyDiscountFilters);
          }
          if (typeFilter) {
            typeFilter.addEventListener("change", applyDiscountFilters);
          }
          if (searchInput) {
            searchInput.addEventListener("input", applyDiscountFilters);
          }
        })
        .catch(err => {
          console.error("Error loading discounts:", err);
          if (container) {
            container.innerHTML =
              '<p class="text-danger">Unable to load discounts and perks right now.</p>';
          }
        });
    });
  </script>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>